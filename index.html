<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate Projects</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #map { height: 400px; width: 100%; }
  </style>
</head>
<body>
  <div class="container mt-5">
    <!-- Map -->
    <div id="map"></div>

    <!-- Projects List -->
    <h2 class="my-4">Our Projects</h2>
    <div id="projects-list" class="row"></div>

    <!-- Pagination -->
    <nav>
      <ul class="pagination justify-content-center">
        <li class="page-item"><a class="page-link" href="#" id="prev-page">Previous</a></li>
        <li class="page-item"><a class="page-link" href="#" id="next-page">Next</a></li>
      </ul>
    </nav>

    <!-- Mortgage Calculator -->
    <div class="mt-4">
      <h3>Mortgage Calculator</h3>
      <div class="form-group">
        <label for="loan-amount">Loan Amount</label>
        <input type="number" class="form-control" id="loan-amount" placeholder="Amount in USD">
      </div>
      <div class="form-group">
        <label for="interest-rate">Interest Rate (%)</label>
        <input type="number" class="form-control" id="interest-rate" placeholder="Interest rate">
      </div>
      <div class="form-group">
        <label for="loan-term">Loan Term (years)</label>
        <input type="number" class="form-control" id="loan-term" placeholder="Years">
      </div>
      <button class="btn btn-primary mt-3" id="calculate-mortgage">Calculate</button>
      <h4 class="mt-3" id="monthly-payment">Monthly Payment: $0.00</h4>
    </div>

    <!-- WhatsApp Contact -->
    <div class="mt-5 text-center">
      <a href="https://wa.me/yourwhatsappnumber" class="btn btn-success">
        Contact us on WhatsApp
      </a>
    </div>
  </div>

  <script>
    const map = L.map('map').setView([0, 0], 13); // Set default location

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    async function fetchProjects(page = 1) {
      const response = await fetch(`https://your-backend-api/projects?page=${page}`);
      const projects = await response.json();

      const projectsList = document.getElementById('projects-list');
      projectsList.innerHTML = ''; // Clear previous projects

      projects.data.forEach(project => {
        const projectElement = document.createElement('div');
        projectElement.classList.add('col-md-4');
        projectElement.innerHTML = `
          <div class="card mb-4">
            <img src="${project.imageUrl}" class="card-img-top" alt="${project.name}">
            <div class="card-body">
              <h5 class="card-title">${project.name}</h5>
              <p class="card-text">${project.description}</p>
              <a href="project-detail.html?id=${project.id}" class="btn btn-primary">View Details</a>
            </div>
          </div>
        `;
        projectsList.appendChild(projectElement);

        // Add marker to map
        L.marker([project.latitude, project.longitude]).addTo(map)
          .bindPopup(`<b>${project.name}</b><br>${project.address}`).on('click', function() {
            window.location.href = `project-detail.html?id=${project.id}`;
          });
      });
    }

    document.getElementById('prev-page').addEventListener('click', function() {
      const currentPage = parseInt(localStorage.getItem('page') || '1');
      if (currentPage > 1) {
        localStorage.setItem('page', currentPage - 1);
        fetchProjects(currentPage - 1);
      }
    });

    document.getElementById('next-page').addEventListener('click', function() {
      const currentPage = parseInt(localStorage.getItem('page') || '1');
      localStorage.setItem('page', currentPage + 1);
      fetchProjects(currentPage + 1);
    });

    document.getElementById('calculate-mortgage').addEventListener('click', function() {
      const loanAmount = parseFloat(document.getElementById('loan-amount').value);
      const interestRate = parseFloat(document.getElementById('interest-rate').value) / 100 / 12;
      const loanTerm = parseInt(document.getElementById('loan-term').value) * 12;

      const monthlyPayment = loanAmount * interestRate / (1 - Math.pow(1 + interestRate, -loanTerm));
      document.getElementById('monthly-payment').textContent = `Monthly Payment: $${monthlyPayment.toFixed(2)}`;
    });

    // Initial fetch for projects
    fetchProjects(1);
  </script>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</body>
</html>
