<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æˆ¿äº§åœ°å›¾åˆ†é¡µå±•ç¤º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    body { margin: 0; padding: 0; }
    #map { height: 400px; width: 100%; }
    .project-list { padding: 20px; }
    .pagination { justify-content: center; }
    .floating-buttons {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
  </style>
</head>
<body>

  <!-- åœ°å›¾åŒºåŸŸ -->
  <div id="map"></div>

  <!-- æˆ¿äº§é¡¹ç›®åˆ—è¡¨ -->
  <div class="container project-list">
    <h2 class="mb-4">ç²¾é€‰æˆ¿åœ°äº§é¡¹ç›®</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4" id="project-container"></div>
    <nav>
      <ul class="pagination mt-4">
        <li class="page-item"><a class="page-link" href="#" id="prevPage">ä¸Šä¸€é¡µ</a></li>
        <li class="page-item"><a class="page-link" href="#" id="nextPage">ä¸‹ä¸€é¡µ</a></li>
      </ul>
    </nav>
  </div>

  <!-- æµ®åŠ¨æŒ‰é’® -->
  <div class="floating-buttons">
    <a href="https://wa.me/60169583621" target="_blank" class="btn btn-success">ğŸ“ WhatsApp è”ç³»æˆ‘</a>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#calculatorModal">ğŸ§® æˆ¿è´·è®¡ç®—å™¨</button>
  </div>

  <!-- æˆ¿è´·è®¡ç®—å™¨ Modal -->
  <div class="modal fade" id="calculatorModal" tabindex="-1" aria-labelledby="calculatorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title" id="calculatorModalLabel">æˆ¿è´·è®¡ç®—å™¨</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="å…³é—­"></button>
        </div>
        <div class="modal-body">
          <form id="loanForm">
            <div class="mb-3">
              <label for="price" class="form-label">æˆ¿ä»· (RM)</label>
              <input type="number" class="form-control" id="price" required>
            </div>
            <div class="mb-3">
              <label for="downpayment" class="form-label">å¤´æœŸæ¬¾ (RM)</label>
              <input type="number" class="form-control" id="downpayment" required>
            </div>
            <div class="mb-3">
              <label for="years" class="form-label">è´·æ¬¾å¹´é™</label>
              <input type="number" class="form-control" id="years" required>
            </div>
            <div class="mb-3">
              <label for="rate" class="form-label">å¹´åˆ©ç‡ (%)</label>
              <input type="number" class="form-control" id="rate" step="0.01" required>
            </div>
            <div class="mb-3">
              <button type="submit" class="btn btn-primary">è®¡ç®—</button>
            </div>
          </form>
          <div id="result" class="alert alert-info d-none"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaflet + Bootstrap JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const projects = [
      { id: 'project-a', title: 'é¡¹ç›® A', desc: 'å‰éš†å¡å¸‚ä¸­å¿ƒï¼Œ3æˆ¿2å…', img: 'https://via.placeholder.com/300x200', lat: 3.139, lng: 101.6869, page: 1 },
      { id: 'project-b', title: 'é¡¹ç›® B', desc: 'å…«æ‰“çµå†ä¹Ÿé«˜å±‚ä½å®…', img: 'https://via.placeholder.com/300x200', lat: 3.105, lng: 101.640, page: 1 },
      { id: 'project-c', title: 'é¡¹ç›® C', desc: 'æ¢³é‚¦å†ä¹Ÿæ°¸ä¹…åœ°å¥‘', img: 'https://via.placeholder.com/300x200', lat: 3.073, lng: 101.518, page: 1 },
      { id: 'project-d', title: 'é¡¹ç›® D', desc: 'åŒå¨åŸè¿‘æ·è¿', img: 'https://via.placeholder.com/300x200', lat: 3.072, lng: 101.607, page: 2 },
      { id: 'project-e', title: 'é¡¹ç›® E', desc: 'æ²™ç™»æ–°åŒºä½å®…', img: 'https://via.placeholder.com/300x200', lat: 3.020, lng: 101.700, page: 2 },
      { id: 'project-f', title: 'é¡¹ç›® F', desc: 'èµ›åŸç»¿æ„æ´‹æˆ¿', img: 'https://via.placeholder.com/300x200', lat: 2.950, lng: 101.661, page: 2 },
      { id: 'project-g', title: 'é¡¹ç›® G', desc: 'è’²ç§å®æƒ å…¬å¯“', img: 'https://via.placeholder.com/300x200', lat: 3.045, lng: 101.629, page: 3 },
      { id: 'project-h', title: 'é¡¹ç›® H', desc: 'å‰éš†å¡å—åŒºå…¨æ–°é¡¹ç›®', img: 'https://via.placeholder.com/300x200', lat: 3.080, lng: 101.680, page: 3 },
    ];

    let currentPage = 1;
    const pageSize = 6;

    let map;
    let markers = [];

    function renderProjects() {
      const container = document.getElementById('project-container');
      container.innerHTML = '';
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageProjects = projects.slice(start, end);
      pageProjects.forEach(p => {
        const col = document.createElement('div');
        col.className = 'col';
        col.id = p.id;
        col.innerHTML = `
          <div class="card">
            <img src="${p.img}" class="card-img-top" alt="${p.title}">
            <div class="card-body">
              <h5 class="card-title">${p.title}</h5>
              <p class="card-text">${p.desc}</p>
              <a href="#" class="btn btn-primary">æŸ¥çœ‹è¯¦æƒ…</a>
            </div>
          </div>
        `;
        container.appendChild(col);
      });
    }

    function renderMap() {
      // åˆå§‹åŒ–åœ°å›¾ï¼Œå¦‚æœåœ°å›¾å·²ç»å­˜åœ¨åˆ™ä¸é‡æ–°åˆ›å»º
      if (!map) {
        map = L.map('map').setView([3.139, 101.6869], 11);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
      }

      // æ¸…é™¤å·²æœ‰çš„ markers
      markers.forEach(marker => map.removeLayer(marker));
      markers = [];

      // åœ¨åœ°å›¾ä¸Šæ·»åŠ  marker
      projects.forEach(p => {
        const marker = L.marker([p.lat, p.lng]).addTo(map)
          .bindPopup(`${p.title}ï¼ˆç‚¹å‡»è·³è½¬ï¼‰`)
          .on('click', () => {
            // åˆ¤æ–­ Marker å±äºå“ªä¸€é¡µ
            if (currentPage !== p.page) {
              currentPage = p.page;
              renderProjects();  // é‡æ–°æ¸²æŸ“é¡µé¢
              renderMap();       // é‡æ–°æ¸²æŸ“åœ°å›¾
            }
            const target = document.getElementById(p.id);
            if (target) {
              target.scrollIntoView({ behavior: 'smooth' });
            } else {
              alert('é¡¹ç›®å½“å‰ä¸åœ¨æœ¬é¡µï¼Œè¯·åˆ‡æ¢åˆ†é¡µæŸ¥çœ‹ã€‚');
            }
          });

        markers.push(marker);
      });
    }

    document.getElementById('prevPage').addEventListener('click', e => {
      e.preventDefault();
      if (currentPage > 1) {
        currentPage--;
        renderProjects();
        renderMap();
      }
    });

    document.getElementById('nextPage').addEventListener('click', e => {
      e.preventDefault();
      if (currentPage < Math.ceil(projects.length / pageSize)) {
        currentPage++;
        renderProjects();
        renderMap();
      }
    });

    renderProjects();
    renderMap();

    // æˆ¿è´·è®¡ç®—å™¨é€»è¾‘
    document.getElementById('loanForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const price = parseFloat(document.getElementById('price').value);
      const down = parseFloat(document.getElementById('downpayment').value);
      const years = parseInt(document.getElementById('years').value);
      const rate = parseFloat(document.getElementById('rate').value) / 100;

      const loanAmount = price - down;
      const monthlyRate = rate / 12;
      const months = years * 12;
      const monthlyPayment = loanAmount * monthlyRate / (1 - Math.pow(1 + monthlyRate, -months));

      const resultDiv = document.getElementById('result');
      resultDiv.classList.remove('d-none');
      resultDiv.textContent = `æ¯æœˆä¾›æ¬¾å¤§çº¦ï¼šRM ${monthlyPayment.toFixed(2)}`;
    });
  </script>
</body>
</html>
